<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"></meta>
<title>Upload Files using XMLHttpRequest - Minimal</title>
<script type="text/javascript" src="/js/jquery.min.js"></script>
</head>
<body>
	<form id="form1" enctype="multipart/form-data" method="post">
		<div class="row">
			<label for="fileToUpload">Select a File to Upload</label><br /> <input
				type="file" name="fileToUpload" id="uploadFile" />
		</div>
		<div class="row">
			<input type="button" onclick="aaa();" value="aaa"></input>
		</div>
		<div class="progress" style="width: 200px;height:20px; border:1px solid #ccc;border-radius: 10px;margin: 10px 0px;overflow: hidden;">
			<div id="processBar" style=" width: 0px;height: 100%; background-color: yellowgreen;transition: all .3s ease;">
				<span id="processhtml"></span>
			</div>
		</div>
	</form>
	
	<script type="text/javascript">
		function aaa(){                                            
	        var formData = new FormData();
	         formData.append("file",$("#uploadFile")[0].files[0]);
	         $.ajax({
	            type:"post",
	            async:true, 
	            Accept:'text/html;charset=UTF-8',
	            data:formData,
	            contentType:"multipart/form-data",
	            url: "/upload",
	            processData: false, // 告诉jQuery不要去处理发送的数据
	            contentType: false, // 告诉jQuery不要去设置Content-Type请求头
	            xhr:function(){                        
	                myXhr = $.ajaxSettings.xhr();
	                if(myXhr.upload){ 
	                    myXhr.upload.addEventListener('progress',function(e){                            
	                        var loaded = e.loaded;                  		//已经上传大小情况 
	                        var total = e.total;                     	 	//附件总大小 
	                        var percent = Math.floor(100*loaded/total)+"%"; //已经上传的百分比  
	                        console.log("已经上传了："+percent);                 
	                        $("#processBar").css("width",percent);
	                        $("#processhtml").html(percent);
	                    }, true); 
	                }
	                return myXhr;
	            },                    
	            success:function(data){                  
	                console.log("上传成功!!!!");                        
	            },
	            error:function(){
	                alert("上传失败！");
	            }
	        });                             
		}
	</script>
</body>
</html>